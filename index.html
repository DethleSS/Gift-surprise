<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />

<title>üéÅ –ü–æ—Å–ª–µ–¥–Ω—è—è –∫–æ—Ä–æ–±–∫–∞</title>

<style>
body{
  margin:0;
  background:#0b0b0b;
  font-family:-apple-system,BlinkMacSystemFont,sans-serif;
  overflow:hidden;
  color:white;
}

/* ---------- –°–¢–ê–†–¢ ---------- */
#startScreen{
  position:fixed; inset:0;
  display:flex; align-items:center; justify-content:center;
  background:radial-gradient(circle,#1a1a1a,#000);
}
#startBtn{
  width:85%; height:28dvh;
  font-size:30px; font-weight:700;
  border-radius:30px; border:none;
  background:linear-gradient(135deg,#fff,#e8e8e8);
}

/* =================================================
   üéÆ MINI GAME (–ª–æ–≤–∏–º –ø–æ–¥–∞—Ä–∫–∏ –∫–æ—Ä–∑–∏–Ω–æ–π)
================================================= */
#gameScreen{
  display:none;
  position:fixed; inset:0;
  background:#000;
  overflow:hidden;
}

#score{
  position:absolute;
  top:20px;
  width:100%;
  text-align:center;
  font-size:22px;
}

#basket{
  position:absolute;
  bottom:20px;
  font-size:70px;
  left:50%;
  transform:translateX(-50%);
}

.fall{
  position:absolute;
  font-size:40px;
  pointer-events:none;
}

/* ---------- –í–ò–î–ï–û ---------- */
video{
  display:none;
  position:fixed; inset:0;
  width:100vw; height:100dvh;
  object-fit:contain;
  background:black;
}

/* ---------- POPUPS / OVERLAY ---------- */
#overlay{
  display:none;
  position:fixed; inset:0;
  background:rgba(0,0,0,.75);
  backdrop-filter:blur(10px);
  opacity:0;
  transition:.5s;
  z-index:5;
}

.popup{
  display:none;
  position:fixed;
  top:50%; left:50%;
  transform:translate(-50%,-50%) scale(.85);
  width:90%; max-width:420px;
  padding:30px;
  background:white; color:black;
  border-radius:28px;
  text-align:center;
  opacity:0;
  transition:.35s;
  z-index:10;
}
.popup.show{
  opacity:1;
  transform:translate(-50%,-50%) scale(1);
}

.math{font-size:20px;margin:18px 0}
.answers{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.answers button{padding:12px;border:none;border-radius:12px;background:#eee}
.finalText{font-size:24px;font-weight:700}

/* confetti */
#confetti{position:fixed;inset:0;pointer-events:none;z-index:20}
</style>
</head>

<body>

<div id="startScreen">
  <button id="startBtn">üéÅ –û—Ç–∫—Ä—ã—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é –∫–æ—Ä–æ–±–∫—É</button>
</div>

<!-- üéÆ –ò–ì–†–ê -->
<div id="gameScreen">
  <div id="score">–ü–æ–π–º–∞–π –ø–æ–¥–∞—Ä–∫–∏: 0 / 5</div>
  <div id="basket">üß∫</div>
</div>

<video id="vid" playsinline>
  <source src="./video.mp4" type="video/mp4">
</video>

<div id="overlay"></div>
<canvas id="confetti"></canvas>

<!-- –ú–ê–¢–ï–ú–ê–¢–ò–ö–ê (–≤–µ—Ä–Ω—É–ª–∏ –æ—Ç–≤–µ—Ç—ã) -->
<div id="mathPopup" class="popup">
  <h2>–ü–æ–¥–æ–∂–¥–∏‚Ä¶</h2>
  <div class="math">
    log‚ÇÇ(256) √ó ‚àö144 + 7¬≥ ‚àí (15 √∑ 3) =
  </div>
  <div class="answers">
    <button>42</button><button>128</button>
    <button>731</button><button>96</button>
    <button>512</button><button>37</button>
    <button>404</button><button>81</button>
    <button>999</button><button>???</button>
  </div>
</div>

<div id="midPopup" class="popup">
  <div class="finalText">
    –õ–∞–¥–Ω–æ‚Ä¶ üòÖ<br><br>–ù–µ –±—É–¥—É –≥—Ä—É–∑–∏—Ç—å –º–∞—Ç–µ–º–∞—Ç–∏–∫–æ–π
  </div>
</div>

<div id="finalPopup" class="popup">
  <div class="finalText">
    –¢—ã —Ç–æ—á–Ω–æ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ–ª–∞<br>
    <b>–í–°–ï –∫–æ—Ä–æ–±–∫–∏?</b> üéÅ
  </div>
</div>

<script>
const btn=startScreen.querySelector('button')
const gameScreen=document.getElementById('gameScreen')
const basket=document.getElementById('basket')
const scoreEl=document.getElementById('score')

const vid=document.getElementById('vid')
const overlay=document.getElementById('overlay')
const mathPopup=document.getElementById('mathPopup')
const midPopup=document.getElementById('midPopup')
const finalPopup=document.getElementById('finalPopup')

/* helpers */
const show=e=>{e.style.display='block';requestAnimationFrame(()=>e.classList.add('show'))}
const hide=e=>{e.classList.remove('show');setTimeout(()=>e.style.display='none',300)}

/* =================================================
   üéÆ GAME LOGIC
================================================= */
let score=0
const need=5
let gameInterval

function moveBasket(x){
  basket.style.left=x+'px'
}

/* –¥–≤–∏–∂–µ–Ω–∏–µ –ø–∞–ª—å—Ü–µ–º */
gameScreen.addEventListener('touchmove',e=>{
  moveBasket(e.touches[0].clientX)
})
gameScreen.addEventListener('mousemove',e=>{
  moveBasket(e.clientX)
})

function spawnGift(){
  const g=document.createElement('div')
  g.className='fall'
  g.textContent='üéÅ'

  g.style.left=Math.random()*window.innerWidth+'px'
  g.style.top='-40px'
  gameScreen.appendChild(g)

  let y=-40

  const fall=setInterval(()=>{
    y+=5
    g.style.top=y+'px'

    const b=basket.getBoundingClientRect()
    const r=g.getBoundingClientRect()

    /* –ø–æ–π–º–∞–ª–∏ */
    if(
      r.bottom>=b.top &&
      r.left<b.right &&
      r.right>b.left
    ){
      clearInterval(fall)
      g.remove()
      score++
      if(navigator.vibrate) navigator.vibrate(20)
      scoreEl.textContent=`–ü–æ–π–º–∞–π –ø–æ–¥–∞—Ä–∫–∏: ${score} / ${need}`

      if(score>=need){
        clearInterval(gameInterval)
        startVideoFlow()
      }
    }

    if(y>window.innerHeight){
      clearInterval(fall)
      g.remove()
    }

  },16)
}

function startGame(){
  score=0
  scoreEl.textContent=`–ü–æ–π–º–∞–π –ø–æ–¥–∞—Ä–∫–∏: 0 / ${need}`
  gameScreen.style.display='block'
  gameInterval=setInterval(spawnGift,900)
}

/* =================================================
   VIDEO FLOW (—Ç–≤–æ–π —Å—Ç–∞—Ä—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π)
================================================= */
async function startVideoFlow(){

  gameScreen.style.display='none'

  vid.style.display='block'
  await vid.play()

  setTimeout(()=>{
    vid.volume=.15
    overlay.style.display='block'
    overlay.style.opacity='1'

    show(mathPopup)

    setTimeout(()=>{
      hide(mathPopup)
      show(midPopup)

      setTimeout(()=>{
        hide(midPopup)
        show(finalPopup)
        setTimeout(startConfetti,2000)
      },4000)

    },5000)

  },10000)
}

/* =================================================
   CONFETTI (emoji rain)
================================================= */
const canvas=document.getElementById('confetti')
const ctx=canvas.getContext('2d')
const emojis=['‚ù§Ô∏è','üéÅ','üíñ','‚ú®']

function resize(){canvas.width=innerWidth;canvas.height=innerHeight}
resize();window.onresize=resize

function startConfetti(){
  const pieces=Array.from({length:120},()=>({
    x:Math.random()*canvas.width,
    y:-20,
    s:20+Math.random()*20,
    v:2+Math.random()*3,
    e:emojis[Math.floor(Math.random()*emojis.length)]
  }))

  const start=Date.now()

  function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height)
    pieces.forEach(p=>{
      p.y+=p.v
      ctx.font=p.s+'px serif'
      ctx.fillText(p.e,p.x,p.y)
    })
    if(Date.now()-start<3000) requestAnimationFrame(draw)
  }
  draw()
}

/* ================================================= */
btn.onclick=()=>{
  startScreen.style.display='none'
  startGame()
}
</script>

</body>
</html>
