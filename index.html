<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
<title>üéÅ –ü–æ—Å–ª–µ–¥–Ω—è—è –∫–æ—Ä–æ–±–∫–∞</title>

<style>
html, body{
  margin:0;
  height:100%;
  overflow:hidden;
  overscroll-behavior:none;
  touch-action:none;
  background:#0b0b0b;
  font-family:-apple-system,BlinkMacSystemFont,sans-serif;
  color:white;
}

/* ================= GAME ================= */
#gameScreen{
  position:fixed;
  inset:0;
  background:#000;
}

#bucket{
  position:absolute;
  bottom:20px;
  width:90px;
  height:55px;
  background:#fff;
  border-radius:12px;
}

.fall{
  position:absolute;
  font-size:32px;
}

#gameText{
  position:absolute;
  top:20px;
  width:100%;
  text-align:center;
  font-size:22px;
}

#afterGame{
  display:none;
  position:fixed;
  inset:0;
  align-items:center;
  justify-content:center;
  background:radial-gradient(circle,#1a1a1a,#000);
}

/* ================= BUTTON ================= */
#startBtn{
  width:85%;
  height:28dvh;
  font-size:30px;
  font-weight:700;
  border-radius:30px;
  border:none;
  background:linear-gradient(135deg,#fff,#e8e8e8);
  color:black;
}

/* ================= VIDEO ================= */
video{
  display:none;
  position:fixed;
  inset:0;
  width:100vw;
  height:100dvh;
  object-fit:contain;
  background:black;
}

/* ================= OVERLAY ================= */
#overlay{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.75);
  backdrop-filter:blur(8px);
  opacity:0;
  transition:.4s;
  z-index:5;
}

/* ================= POPUP ================= */
.popup{
  display:none;
  position:fixed;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%) scale(.85);
  width:90%;
  max-width:420px;
  padding:28px;
  background:white;
  color:black;
  border-radius:26px;
  text-align:center;
  opacity:0;
  transition:.35s;
  z-index:10;
}

.popup.show{
  opacity:1;
  transform:translate(-50%,-50%) scale(1);
}

.answers{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:8px;
  margin-top:15px;
}

.answers button{
  padding:10px;
  border:none;
  border-radius:10px;
  font-size:16px;
}

/* ================= CONFETTI ================= */
#confetti{
  position:fixed;
  inset:0;
  pointer-events:none;
  z-index:20;
}
</style>
</head>

<body>

<!-- ================= GAME ================= -->
<div id="gameScreen">
  <div id="gameText">–ü–æ–π–º–∞–π 8 –ø–æ–¥–∞—Ä–∫–æ–≤ üéÅ</div>
  <div id="bucket"></div>
</div>

<div id="afterGame">
  <button id="startBtn">üéÅ –û—Ç–∫—Ä—ã—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é –∫–æ—Ä–æ–±–∫—É</button>
</div>

<!-- ================= VIDEO ================= -->
<video id="vid" playsinline>
  <source src="./video.mp4" type="video/mp4">
</video>

<div id="overlay"></div>
<canvas id="confetti"></canvas>

<!-- ================= POPUPS ================= -->
<div id="mathPopup" class="popup">
  <h3>–ü–æ–¥–æ–∂–¥–∏‚Ä¶ —Ä–µ—à–∏ –ø—Ä–∏–º–µ—Ä üòà</h3>
  log‚ÇÇ(256) √ó ‚àö144 + 7¬≥ ‚àí (15 √∑ 3) =
  <div class="answers">
    <button>42</button><button>128</button>
    <button>731</button><button>96</button>
    <button>512</button><button>37</button>
    <button>404</button><button>81</button>
  </div>
</div>

<div id="midPopup" class="popup">
  –õ–∞–¥–Ω–æ‚Ä¶ üòÖ<br>–ù–µ –±—É–¥—É –≥—Ä—É–∑–∏—Ç—å –º–∞—Ç–µ–º–∞—Ç–∏–∫–æ–π
</div>

<div id="finalPopup" class="popup">
  –¢—ã —Ç–æ—á–Ω–æ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ–ª–∞<br><b>–í–°–ï –∫–æ—Ä–æ–±–∫–∏?</b> üéÅ
</div>

<script>
/* ================= HELPERS ================= */
function show(el){el.style.display='block';requestAnimationFrame(()=>el.classList.add('show'))}
function hide(el){el.classList.remove('show');setTimeout(()=>el.style.display='none',300)}

/* ================= GAME ================= */
const game=document.getElementById('gameScreen')
const bucket=document.getElementById('bucket')
const afterGame=document.getElementById('afterGame')

let caught=0
let bucketX=innerWidth/2-45
bucket.style.left=bucketX+'px'

function move(x){
  bucketX=x-45
  bucket.style.left=bucketX+'px'
}
game.ontouchmove=e=>move(e.touches[0].clientX)
game.onmousemove=e=>move(e.clientX)

function spawn(){
  const el=document.createElement('div')
  el.className='fall'
  el.textContent='üéÅ'
  el.style.left=Math.random()*innerWidth+'px'
  el.style.top='-30px'
  game.appendChild(el)

  let y=0
  const speed=3+Math.random()*2

  const fall=setInterval(()=>{
    y+=speed
    el.style.top=y+'px'

    const bx=bucketX
    const ex=parseFloat(el.style.left)

    if(y>innerHeight-80 && ex>bx && ex<bx+90){
      caught++
      el.remove()
      clearInterval(fall)
      if(caught>=8){
        game.style.display='none'
        afterGame.style.display='flex'
      }
    }

    if(y>innerHeight) {el.remove();clearInterval(fall)}
  },16)
}
setInterval(spawn,700)

/* ================= VIDEO FLOW ================= */
const btn=document.getElementById('startBtn')
const vid=document.getElementById('vid')
const overlay=document.getElementById('overlay')
const mathPopup=document.getElementById('mathPopup')
const midPopup=document.getElementById('midPopup')
const finalPopup=document.getElementById('finalPopup')

btn.onclick=async()=>{

  afterGame.style.display='none'

  vid.style.display='block'
  vid.muted=true
  await vid.play()
  vid.muted=false

  setTimeout(()=>{

    vid.volume=.15

    overlay.style.display='block'
    overlay.style.opacity='1'
    show(mathPopup)

    setTimeout(()=>{
      hide(mathPopup)
      show(midPopup)

      setTimeout(()=>{
        hide(midPopup)
        show(finalPopup)
        setTimeout(startConfetti,2000)
      },4000)

    },5000)

  },10000)
}

/* ================= CONFETTI ================= */
const canvas=document.getElementById('confetti')
const ctx=canvas.getContext('2d')
const emojis=['‚ù§Ô∏è','üéÅ','‚ú®','üíñ']
let pieces=[]

function resize(){canvas.width=innerWidth;canvas.height=innerHeight}
resize();onresize=resize

function startConfetti(){
  pieces=[]
  for(let i=0;i<120;i++){
    pieces.push({
      x:Math.random()*canvas.width,
      y:-20,
      size:18+Math.random()*18,
      speed:2+Math.random()*3,
      emoji:emojis[Math.floor(Math.random()*emojis.length)]
    })
  }

  const start=Date.now()

  function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height)
    pieces.forEach(p=>{
      p.y+=p.speed
      ctx.font=p.size+'px serif'
      ctx.fillText(p.emoji,p.x,p.y)
    })

    if(Date.now()-start<3000) requestAnimationFrame(draw)
  }
  draw()
}
</script>

</body>
</html>
