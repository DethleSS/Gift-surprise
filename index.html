<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />

<title>üéÅ –ü–æ—Å–ª–µ–¥–Ω—è—è –∫–æ—Ä–æ–±–∫–∞</title>

<style>
body {
  margin: 0;
  background: #0b0b0b;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  overflow: hidden;
  color: white;
}

/* ---------- –°–¢–ê–†–¢ ---------- */
#startScreen {
  position: fixed;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  background: radial-gradient(circle at center, #1a1a1a, #000);
}

#startBtn {
  width: 85%;
  height: 28dvh;
  font-size: 30px;
  font-weight: 700;
  border-radius: 30px;
  border: none;
  background: linear-gradient(135deg,#ffffff,#e8e8e8);
  color: black;
}

/* ---------- üéÆ –ú–ò–ù–ò –ò–ì–†–ê ---------- */
#gameScreen{
  display:none;
  position:fixed;
  inset:0;
  background:#000;
}

#score{
  position:absolute;
  top:20px;
  width:100%;
  text-align:center;
  font-size:22px;
  opacity:.85;
}

.gift{
  position:absolute;
  font-size:52px;
  user-select:none;
  cursor:pointer;
  transition:.15s;
}
.gift:active{
  transform:scale(.9);
}

/* ---------- –í–ò–î–ï–û ---------- */
video {
  display: none;
  position: fixed;
  inset: 0;
  width: 100vw;
  height: 100dvh;
  object-fit: contain;
  background: black;
}

/* ---------- –ó–ê–¢–ï–ú–ù–ï–ù–ò–ï ---------- */
#overlay {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.75);
  backdrop-filter: blur(10px);
  opacity: 0;
  transition: opacity .5s;
  z-index: 5;
}

/* ---------- POPUP ---------- */
.popup {
  display: none;
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) scale(.85);
  width: 90%;
  max-width: 420px;
  padding: 30px;
  background: white;
  color: black;
  border-radius: 28px;
  text-align: center;
  box-shadow: 0 30px 80px rgba(0,0,0,.7);
  opacity: 0;
  transition: .35s;
  z-index: 10;
}

.popup.show {
  opacity: 1;
  transform: translate(-50%, -50%) scale(1);
}

.math { font-size: 20px; margin: 18px 0 22px; }
.answers { display:grid; grid-template-columns:1fr 1fr; gap:10px; }
.answers button { padding:12px; border:none; border-radius:12px; background:#eee; }
.finalText { font-size: 24px; font-weight: 700; }

/* ---------- CONFETTI ---------- */
#confetti {
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 20;
}
</style>
</head>

<body>

<div id="startScreen">
  <button id="startBtn">üéÅ –û—Ç–∫—Ä—ã—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é –∫–æ—Ä–æ–±–∫—É</button>
</div>

<!-- üéÆ –ò–ì–†–ê -->
<div id="gameScreen">
  <div id="score">–ü–æ–π–º–∞–π –ø–æ–¥–∞—Ä–∫–∏: 0 / 5</div>
</div>

<video id="vid" playsinline>
  <source src="./video.mp4" type="video/mp4">
</video>

<div id="overlay"></div>
<canvas id="confetti"></canvas>

<!-- –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ -->
<div id="mathPopup" class="popup">
  <h2>–ü–æ–¥–æ–∂–¥–∏‚Ä¶</h2>
  <div class="math">log‚ÇÇ(256) √ó ‚àö144 + 7¬≥ ‚àí (15 √∑ 3) =</div>
</div>

<!-- –ü–†–û–ú–ï–ñ–£–¢–û–ß–ù–´–ô -->
<div id="midPopup" class="popup">
  <div class="finalText">
    –õ–∞–¥–Ω–æ‚Ä¶ üòÖ<br><br>
    –ù–µ –±—É–¥—É –≥—Ä—É–∑–∏—Ç—å –º–∞—Ç–µ–º–∞—Ç–∏–∫–æ–π
  </div>
</div>

<!-- –§–ò–ù–ê–õ -->
<div id="finalPopup" class="popup">
  <div class="finalText">
    –¢—ã —Ç–æ—á–Ω–æ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ–ª–∞<br>
    <b>–í–°–ï –∫–æ—Ä–æ–±–∫–∏?</b> üéÅ
  </div>
</div>

<script>
const btn = document.getElementById('startBtn')
const startScreen = document.getElementById('startScreen')
const gameScreen = document.getElementById('gameScreen')
const scoreEl = document.getElementById('score')

const vid = document.getElementById('vid')
const overlay = document.getElementById('overlay')

const mathPopup = document.getElementById('mathPopup')
const midPopup = document.getElementById('midPopup')
const finalPopup = document.getElementById('finalPopup')

/* ---------- helpers ---------- */
function show(el){ el.style.display='block'; requestAnimationFrame(()=>el.classList.add('show')) }
function hide(el){ el.classList.remove('show'); setTimeout(()=>el.style.display='none',300) }

/* =========================
   üéÆ MINI GAME
========================= */
let score = 0
const need = 5

function spawnGift(){
  const g=document.createElement('div')
  g.className='gift'
  g.textContent='üéÅ'
  g.style.left=Math.random()*80+'vw'
  g.style.top=Math.random()*80+'vh'

  g.onclick=()=>{
    if(navigator.vibrate) navigator.vibrate(15)
    g.remove()
    score++
    scoreEl.textContent=`–ü–æ–π–º–∞–π –ø–æ–¥–∞—Ä–∫–∏: ${score} / ${need}`

    if(score>=need){
      startVideoFlow()
    } else {
      spawnGift()
    }
  }

  gameScreen.appendChild(g)
}

/* =========================
   VIDEO FLOW (—Ç–≤–æ—è —Å—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞)
========================= */
async function startVideoFlow(){

  gameScreen.style.display='none'

  vid.style.display='block'
  vid.volume=1
  await vid.play()

  setTimeout(()=>{
    vid.volume=.15
    overlay.style.display='block'
    overlay.style.opacity='1'

    show(mathPopup)

    setTimeout(()=>{
      hide(mathPopup)
      show(midPopup)

      setTimeout(()=>{
        hide(midPopup)
        show(finalPopup)
        setTimeout(startConfetti,2000)
      },4000)

    },5000)

  },10000)
}

/* ---------- CONFETTI (—Ç–≤–æ–π –∫–æ–¥ –æ—Å—Ç–∞–≤–ª–µ–Ω) ---------- */
const canvas=document.getElementById('confetti')
const ctx=canvas.getContext('2d')
const emojis=['‚ù§Ô∏è','üéÅ','üíñ','‚ú®']
let pieces=[]

function resize(){ canvas.width=innerWidth; canvas.height=innerHeight }
resize(); window.onresize=resize

function startConfetti(){
  pieces=[]
  for(let i=0;i<120;i++){
    pieces.push({
      x:Math.random()*canvas.width,
      y:-20,
      size:20+Math.random()*20,
      speed:2+Math.random()*3,
      emoji:emojis[Math.floor(Math.random()*emojis.length)]
    })
  }

  const start=Date.now()

  function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height)
    pieces.forEach(p=>{
      p.y+=p.speed
      ctx.font=p.size+'px serif'
      ctx.fillText(p.emoji,p.x,p.y)
    })

    if(Date.now()-start<3000) requestAnimationFrame(draw)
  }

  draw()
}

/* ---------- START ---------- */
btn.onclick=()=>{
  startScreen.style.display='none'
  gameScreen.style.display='block'
  spawnGift()
}
</script>

</body>
</html>
